<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Messenger Translator üåç</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
h1 { color: #2c3e50; text-align: center; margin-bottom: 15px; }
.controls { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
.controls div { display: flex; align-items: center; gap: 5px; }
select, button { padding: 8px 12px; font-size: 14px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; transition: 0.2s; }
select:hover, button:hover { background: #e6e6e6; }
#indicator1, #indicator2 { width: 12px; height: 12px; border-radius: 50%; background: red; }
#chat { max-width: 600px; margin: auto; background: #fff; padding: 15px; border-radius: 15px; height: 450px; overflow-y: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.2); display: flex; flex-direction: column; }
.message {
  max-width: 70%; padding: 10px 14px; margin: 6px;
  border-radius: 16px; position: relative; word-wrap: break-word;
  opacity: 0; transform: translateY(30px) scale(0.95);
  animation: slideIn 0.4s forwards cubic-bezier(.68,-0.55,.27,1.55);
}
.user1 { background: #dfefff; align-self: flex-start; border-top-left-radius: 0; }
.user2 { background: #fff0df; align-self: flex-end; border-top-right-radius: 0; }
.copy-btn { font-size: 10px; padding: 2px 5px; margin-left: 5px; border: none; background: #3498db; color: white; border-radius: 5px; cursor: pointer; transition: 0.2s; }
.copy-btn:hover { background: #2980b9; }
.note { font-size: 12px; color: #888; text-align: center; margin-top: 5px; }

@keyframes slideIn {
  to { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
  70% { box-shadow: 0 0 0 12px rgba(46, 204, 113, 0); }
  100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
}
.recording {
  background: #2ecc71 !important;
  color: white;
  animation: pulse 1.5s infinite;
}
</style>
</head>
<body>
<h1>Messenger Translator üåç</h1>

<div class="controls">
  <div>
    <label>User 1:</label>
    <select id="lang1">
      <option value="ru-RU">–†—É—Å—Å–∫–∏–π</option>
      <option value="en-US">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
      <option value="es-ES">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
      <option value="fr-FR">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
      <option value="de-DE">–ù–µ–º–µ—Ü–∫–∏–π</option>
      <option value="it-IT">–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π</option>
      <option value="ja-JP">–Ø–ø–æ–Ω—Å–∫–∏–π</option>
      <option value="zh-CN">–ö–∏—Ç–∞–π—Å–∫–∏–π</option>
      <option value="uk-UA">–£–∫—Ä–∞–∏–Ω—Å–∫–∏–π</option>
      <option value="hu-HU">–í–µ–Ω–≥–µ—Ä—Å–∫–∏–π</option>
    </select>
    <button id="start1">üéô Start</button>
    <button id="stop1">‚èπ Stop</button>
    <div id="indicator1"></div>
  </div>

  <div>
    <label>User 2:</label>
    <select id="lang2">
      <option value="en">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="es">–ò—Å–ø–∞–Ω—Å–∫–∏–π</option>
      <option value="fr">–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–π</option>
      <option value="de">–ù–µ–º–µ—Ü–∫–∏–π</option>
      <option value="it">–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–π</option>
      <option value="ja">–Ø–ø–æ–Ω—Å–∫–∏–π</option>
      <option value="zh-CN">–ö–∏—Ç–∞–π—Å–∫–∏–π</option>
      <option value="uk">–£–∫—Ä–∞–∏–Ω—Å–∫–∏–π</option>
      <option value="hu">–í–µ–Ω–≥–µ—Ä—Å–∫–∏–π</option>
    </select>
    <button id="start2">üéô Start</button>
    <button id="stop2">‚èπ Stop</button>
    <div id="indicator2"></div>
  </div>
</div>
<p class="note">*–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É —è–∑—ã–∫–æ–≤ –≤ Chrome</p>

<div id="chat"></div>

<audio id="notify-sound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
  alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç SpeechRecognition. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Chrome –∏–ª–∏ Edge.");
}

const recognition1 = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition1.continuous = true;
recognition1.interimResults = false;

const recognition2 = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition2.continuous = true;
recognition2.interimResults = false;

const chatDiv = document.getElementById('chat');
const lang1Select = document.getElementById('lang1');
const lang2Select = document.getElementById('lang2');
const indicator1 = document.getElementById('indicator1');
const indicator2 = document.getElementById('indicator2');
const sound = document.getElementById('notify-sound');

const startBtn1 = document.getElementById('start1');
const stopBtn1 = document.getElementById('stop1');
const startBtn2 = document.getElementById('start2');
const stopBtn2 = document.getElementById('stop2');

let activeLang1 = lang1Select.value;
lang1Select.onchange = () => activeLang1 = lang1Select.value;

async function translateText(text, source, target){
  const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${source}|${target}`;
  const response = await fetch(url);
  const data = await response.json();
  return data.responseData.translatedText;
}

function addMessage(userClass, text, translation, targetLang){
  const msg = document.createElement('div');
  msg.classList.add('message', userClass);
  msg.textContent = text;
  chatDiv.appendChild(msg);

  const msgTr = document.createElement('div');
  msgTr.classList.add('message', userClass === 'user1' ? 'user2' : 'user1');
  msgTr.innerHTML = `${translation} (${targetLang}) <button class="copy-btn" onclick="navigator.clipboard.writeText('${translation}')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>`;
  chatDiv.appendChild(msgTr);

  chatDiv.scrollTop = chatDiv.scrollHeight; 
  sound.play();

  const utter = new SpeechSynthesisUtterance(translation);
  utter.lang = targetLang + '-' + targetLang.toUpperCase();
  speechSynthesis.speak(utter);
}

// --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ User1 ---
startBtn1.onclick = () => { 
  recognition1.lang = activeLang1; recognition1.start(); 
  indicator1.style.background='green'; 
  startBtn1.classList.add('recording');
};
stopBtn1.onclick = () => { 
  recognition1.stop(); indicator1.style.background='red'; 
  startBtn1.classList.remove('recording');
};

// --- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ User2 ---
startBtn2.onclick = () => { 
  recognition2.lang = lang2Select.value + '-' + lang2Select.value.toUpperCase(); 
  recognition2.start(); indicator2.style.background='green'; 
  startBtn2.classList.add('recording');
};
stopBtn2.onclick = () => { 
  recognition2.stop(); indicator2.style.background='red'; 
  startBtn2.classList.remove('recording');
};

recognition1.onresult = async (event) => {
  let text = event.results[event.results.length-1][0].transcript.trim();
  let sourceLang = activeLang1.split('-')[0];
  let targetLang = lang2Select.value;
  if(!text || text.length < 2){ return; }
  const translation = await translateText(text, sourceLang, targetLang);
  addMessage('user1', text + ` (${sourceLang})`, translation, targetLang);
};

recognition2.onresult = async (event) => {
  let text = event.results[event.results.length-1][0].transcript.trim();
  let sourceLang = lang2Select.value;
  let targetLang = activeLang1.split('-')[0];
  if(!text || text.length < 2){ return; }
  const translation = await translateText(text, sourceLang, targetLang);
  addMessage('user2', text + ` (${sourceLang})`, translation, targetLang);
};
</script>
</body>
</html>
