<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ò–≥—Ä–∞: –ó–∞—â–∏—Ç–∞ –∑–∞–º–∫–∞</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div id="hud">–û—á–∫–∏: 0 | –ñ–∏–∑–Ω–∏: 5</div>

  <!-- Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>

  <script>
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 8, 20);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // –°–≤–µ—Ç
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambientLight);
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(10, 20, 10);
    scene.add(dirLight);

    // –ó–µ–º–ª—è
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(200, 200),
      new THREE.MeshStandardMaterial({ color: 0x228833 })
    );
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    const loader = new THREE.GLTFLoader();

    // –ó–∞–º–æ–∫
    loader.load("castle.glb", (gltf) => {
      const castle = gltf.scene;
      castle.scale.set(5, 5, 5);
      castle.position.set(0, 0, -40);
      scene.add(castle);
    });

    // –ò–≥—Ä–æ–∫-—Ä—ã—Ü–∞—Ä—å
    let player;
    loader.load("knight.glb", (gltf) => {
      player = gltf.scene;
      player.scale.set(2, 2, 2);
      player.position.set(0, 0, 0);
      scene.add(player);
    });

    // –í—Ä–∞–≥–∏
    let enemies = [];
    function spawnEnemy() {
      loader.load("enemy_knight.glb", (gltf) => {
        const enemy = gltf.scene;
        enemy.scale.set(2, 2, 2);
        enemy.position.set((Math.random() - 0.5) * 60, 0, 50); // —Å–ø–∞–≤–Ω —Å–Ω–∞—Ä—É–∂–∏
        scene.add(enemy);
        enemies.push(enemy);
      });
    }

    // HUD
    let score = 0;
    let lives = 5;
    const hud = document.getElementById("hud");

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    const keys = {};
    window.addEventListener("keydown", (e) => keys[e.key] = true);
    window.addEventListener("keyup", (e) => keys[e.key] = false);

    function attack() {
      enemies = enemies.filter(enemy => {
        if (player && player.position.distanceTo(enemy.position) < 3) {
          scene.remove(enemy);
          score++;
          hud.textContent = `–û—á–∫–∏: ${score} | –ñ–∏–∑–Ω–∏: ${lives}`;
          return false;
        }
        return true;
      });
    }
    window.addEventListener("keydown", (e) => { if (e.key === " ") attack(); });

    function animate() {
      requestAnimationFrame(animate);

      if (player) {
        if (keys["w"]) player.position.z -= 0.2;
        if (keys["s"]) player.position.z += 0.2;
        if (keys["a"]) player.position.x -= 0.2;
        if (keys["d"]) player.position.x += 0.2;
      }

      enemies.forEach((enemy, i) => {
        if (player) {
          enemy.lookAt(player.position);
          enemy.translateZ(0.05);
        }

        // –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç –∑–∞–º–æ–∫
        if (enemy.position.z < -38) {
          scene.remove(enemy);
          enemies.splice(i, 1);
          lives--;
          hud.textContent = `–û—á–∫–∏: ${score} | –ñ–∏–∑–Ω–∏: ${lives}`;
          if (lives <= 0) {
            alert("üè∞ –ó–∞–º–æ–∫ –ø–∞–ª! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞.");
            window.location.reload();
          }
        }
      });

      renderer.render(scene, camera);
    }
    animate();

    setInterval(spawnEnemy, 3000);

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
